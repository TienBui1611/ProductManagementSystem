<div class="container">
  <div class="header">
    <h1>Update Product</h1>
    <button class="btn btn-secondary" [routerLink]="['/products']">
      ‚Üê Back to Products
    </button>
  </div>

  <div class="loading" *ngIf="loading">
    <p>Loading product...</p>
  </div>

  <div class="error" *ngIf="loadError">
    <p>{{ loadError }}</p>
    <button class="btn btn-secondary" (click)="loadProduct()">Retry</button>
  </div>

  <form (ngSubmit)="onSubmit()" #productForm="ngForm" class="product-form" *ngIf="!loading && !loadError">
    <div class="product-info">
      <p><strong>MongoDB ID:</strong> {{ originalProduct?._id }}</p>
      <p><strong>Original ID:</strong> {{ originalProduct?.id }}</p>
    </div>

    <div class="form-group">
      <label for="id">Product ID *</label>
      <input
        type="number"
        id="id"
        name="id"
        [(ngModel)]="product.id"
        #id="ngModel"
        required
        min="1"
        class="form-control"
        [class.error]="id.invalid && id.touched">
      <div class="field-error" *ngIf="id.invalid && id.touched">
        Product ID is required and must be a positive number
      </div>
    </div>

    <div class="form-group">
      <label for="name">Product Name *</label>
      <input
        type="text"
        id="name"
        name="name"
        [(ngModel)]="product.name"
        #name="ngModel"
        required
        maxlength="50"
        class="form-control"
        [class.error]="name.invalid && name.touched">
      <div class="field-info">Maximum 50 characters ({{ product.name?.length || 0 }}/50)</div>
      <div class="field-error" *ngIf="name.invalid && name.touched">
        Product name is required
      </div>
    </div>

    <div class="form-group">
      <label for="description">Description *</label>
      <textarea
        id="description"
        name="description"
        [(ngModel)]="product.description"
        #description="ngModel"
        required
        maxlength="255"
        rows="4"
        class="form-control"
        [class.error]="description.invalid && description.touched"></textarea>
      <div class="field-info">Maximum 255 characters ({{ product.description?.length || 0 }}/255)</div>
      <div class="field-error" *ngIf="description.invalid && description.touched">
        Description is required
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="price">Price * ($)</label>
        <input
          type="number"
          id="price"
          name="price"
          [(ngModel)]="product.price"
          #price="ngModel"
          required
          min="0"
          step="0.01"
          class="form-control"
          [class.error]="price.invalid && price.touched">
        <div class="field-error" *ngIf="price.invalid && price.touched">
          Price is required and must be positive
        </div>
      </div>

      <div class="form-group">
        <label for="units">Units in Stock *</label>
        <input
          type="number"
          id="units"
          name="units"
          [(ngModel)]="product.units"
          #units="ngModel"
          required
          min="0"
          class="form-control"
          [class.error]="units.invalid && units.touched">
        <div class="field-error" *ngIf="units.invalid && units.touched">
          Units must be a non-negative number
        </div>
      </div>
    </div>

    <div class="form-actions">
      <button
        type="submit"
        class="btn btn-primary"
        [disabled]="productForm.invalid || submitting">
        {{ submitting ? 'Updating Product...' : 'Update Product' }}
      </button>
    </div>

    <div class="error-message" *ngIf="errorMessage">
      {{ errorMessage }}
    </div>

    <div class="success-message" *ngIf="successMessage">
      {{ successMessage }}
    </div>
  </form>
</div>
